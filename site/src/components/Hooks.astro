---
const hooks = [
  {
    name: 'forbidden-imports',
    tier: 'block',
    desc: 'Block runtime-inappropriate APIs',
    example: 'require("fs") in a Cloudflare Worker',
  },
  {
    name: 'required-prefix',
    tier: 'block',
    desc: 'Enforce route path prefix',
    example: 'Routes missing /alpha/ prefix',
  },
  {
    name: 'boundary-guard',
    tier: 'block',
    desc: 'Enforce module boundaries',
    example: 'Inspector mutating ticket state',
  },
  {
    name: 'test-gate',
    tier: 'block',
    desc: 'Block commits without tests',
    example: 'git commit with untested source files',
  },
  {
    name: 'data-isolation',
    tier: 'warn',
    desc: 'Warn on unfiltered DB queries',
    example: 'D1 query missing tenant filter',
  },
  {
    name: 'delegation-check',
    tier: 'warn',
    desc: 'Warn on inline business logic',
    example: 'Handler with 50+ lines of logic',
  },
  {
    name: 'test-suggest',
    tier: 'info',
    desc: 'Suggest running related tests',
    example: 'Edited src/foo.ts → run tests/foo.test.ts',
  },
  {
    name: 'change-suggest',
    tier: 'info',
    desc: 'Suggest related follow-up actions',
    example: 'Edited inspector → run benchmarks',
  },
  {
    name: 'state-flow',
    tier: 'info',
    desc: 'Enforce unidirectional state flow',
    example: 'Store setter missing notify()',
  },
];
---

<section id="hooks">
  <div class="container">
    <div class="reveal">
      <p class="section-label">Layer 1</p>
      <h2 class="section-title">9 Hooks, 3 Enforcement Tiers</h2>
      <p class="section-desc">
        Hooks run before a tool executes. They see the content before it hits disk
        and can block, warn, or inform.
      </p>

      <div class="hooks-grid">
        {hooks.map((hook) => (
          <div class="hook-item">
            <div class="hook-header">
              <span class={`badge badge-${hook.tier}`}>{hook.tier}</span>
              <code class="hook-name">{hook.name}</code>
            </div>
            <p class="hook-desc">{hook.desc}</p>
            <p class="hook-example">{hook.example}</p>
          </div>
        ))}
      </div>

      <div class="hook-demo">
        <p class="demo-label">Example: Boundary guard in action</p>
        <div class="hook-output">
          Inspector boundary violation:<br />
          1. Direct mutation: <code>ticket.payload = ...</code> — Inspectors return<br />
          &nbsp;&nbsp;&nbsp;verdicts; they must not mutate ticket state. Return a clip<br />
          &nbsp;&nbsp;&nbsp;with Verdict.MODIFY and the modified content instead.<br /><br />
          Principle: "Inspectors return verdicts; Switchboard executes."<br />
          (CLAUDE.md)
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .hooks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1rem;
    margin-bottom: 3rem;
  }

  .hook-item {
    background: var(--bg-mid);
    border: 1px solid var(--bg-surface);
    border-radius: var(--radius);
    padding: 1.25rem;
    transition: border-color 0.3s;
  }

  .hook-item:hover {
    border-color: rgba(0, 255, 240, 0.2);
  }

  .hook-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .hook-name {
    font-size: 0.85rem;
    background: none;
    padding: 0;
    color: var(--text-primary);
  }

  .hook-desc {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .hook-example {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .hook-demo {
    max-width: 700px;
  }

  .demo-label {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
  }

  .hook-demo code {
    background: rgba(255, 68, 68, 0.1);
    color: var(--red);
  }
</style>
